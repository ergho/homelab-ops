---
version: "3"

vars:
  PROJECT_DIR:
    sh: "git rev-parse --show-toplevel"
  TERRAFORM_DIR: "{{.PROJECT_DIR}}/infrastructure/terraform"
tasks:
  init:
    desc: initialize terraform provider
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform init

  upgrade:
    desc: upgrade terraform providers
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform init -upgrade
  plan:
    desc: terraform plan out
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform plan -out homelab

  apply:
    desc: Creates resources from plan
    deps: [plan]
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform apply homelab

  destroy:
    desc: Destroys all terraform resources
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform apply -destroy
